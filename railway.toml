[build]
  builder = "NIXPACKS"
  buildCommand = "pnpm install && npm run build"

[deploy]
  startCommand = "NODE_ENV=production tsx server.ts"
  healthcheckPath = "/api/health"
  healthcheckTimeout = 300
  restartPolicyType = "ON_FAILURE"
  restartPolicyMaxRetries = 10

[[services.ports]]
  port = 8080
  type = "TCP"

[env]
  PORT = "8080"
  NODE_ENV = "production"
